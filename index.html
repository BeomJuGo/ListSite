<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¹€ê³ ë‚œ ì•„ì´í…œ ëª©ë¡</title>

<style>
* { box-sizing: border-box; }

body {
  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem;
  background: #f8fafc;
  color: #1e293b;
}

h1 { font-size: 1.8rem; margin-bottom: 1.5rem; }

.search-box {
  width: 100%;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  margin-bottom: 1rem;
}

.filter-group {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
  align-items: center;
}

.filter-group button {
  padding: 0.4rem 0.8rem;
  border: 1px solid #e2e8f0;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
}

.filter-group button.active {
  background: #3b82f6;
  color: white;
  border-color: #3b82f6;
}

.item-list { list-style: none; padding: 0; margin: 0; }

.item-list li {
  padding: 1rem 1.25rem;
  background: white;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  transition: 0.2s;
}

.item-list li:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

.item-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }

.item-name { font-weight: 600; }

.item-info { display: flex; gap: 0.5rem; flex-wrap: wrap; }

.badge {
  padding: 0.3rem 0.7rem;
  font-size: 0.75rem;
  border-radius: 999px;
  font-weight: 600;
}

/* ë“±ê¸‰ ìƒ‰ìƒ */
.grade-ê³¨ë“œ { background: #facc15; color: #78350f; }
.grade-í¼í”Œ { background: #a855f7; color: white; }
.grade-ë¸”ë£¨ { background: #3b82f6; color: white; }
.grade-ë ˆë“œ { background: #ef4444; color: white; }
.grade-ê·¸ë¦° { background: #22c55e; color: white; }

/* ê°€ê²©, ìˆ˜ëŸ‰, ì„±ë³„ */
.price { background: #dcfce7; color: #166534; }
.qty { background: #e2e8f0; color: #334155; }
.gender { background: #f0fdfa; color: #0f766e; }

.no-results { text-align: center; padding: 3rem; color: #64748b; background: white; border-radius: 8px; }

</style>
</head>

<body>

<h1>ê¹€ê³ ë‚œ ì•„ì´í…œ ëª©ë¡</h1>

<input type="text" class="search-box" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ë„ì–´ì“°ê¸° ë¬´ì‹œ)">

<!-- í•„í„° ë²„íŠ¼ ê·¸ë£¹ -->
<div class="filter-group" id="genderFilters"></div>
<div class="filter-group" id="categoryFilters"></div>
<div class="filter-group" id="gradeFilters"></div>

<ul class="item-list" id="itemList"></ul>
<div class="no-results" id="noResults" style="display:none;">
ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbytKwgl8ya7_Vg6-vObEJUjeFii4yuvsqNn0BBWNBt7YORXEN7mv2FSc4KAoGscL-RVwA/exec"; // ğŸ”¥ Apps Script URL

let ITEMS = [];

const state = {
  category: "ì „ì²´",
  grade: "ì „ì²´",
  gender: "ì „ì²´",
  searchQuery: ""
};

// ê³µìš© í¬í•¨ ëª¨ë“  ì„±ë³„
const GENDERS = ["ì „ì²´","ë‚¨ì„±","ì—¬ì„±","ê³µìš©"];

function removeSpaces(str) { return str.replace(/\s/g,""); }

async function loadItems() {
  try {
    const response = await fetch(WEB_APP_URL + "?t=" + Date.now());
    const data = await response.json();

    ITEMS = data.map(item => ({
      name: item.name,
      category: item.category,
      grade: item.grade,
      price: Number(item.price),
      quantity: Number(item.quantity),
      gender: item.gender && item.gender.trim()!=="" ? item.gender : "ê³µìš©"
    })).filter(i=>i.quantity>0);

    renderFilters();
    filterAndRender();

  } catch(e) {
    console.error(e);
    alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }
}

// í•„í„° ë²„íŠ¼ ë Œë”ë§
function renderFilters() {
  const genderContainer = document.getElementById("genderFilters");
  genderContainer.innerHTML = GENDERS.map(g => `<button data-gender="${g}" class="${state.gender===g?'active':''}">${g}</button>`).join("");

  const categories = ["ì „ì²´", ...new Set(ITEMS.map(i=>i.category))];
  const categoryContainer = document.getElementById("categoryFilters");
  categoryContainer.innerHTML = categories.map(c => `<button data-category="${c}" class="${state.category===c?'active':''}">${c}</button>`).join("");

  const grades = ["ì „ì²´", ...new Set(ITEMS.map(i=>i.grade))];
  const gradeContainer = document.getElementById("gradeFilters");
  gradeContainer.innerHTML = grades.map(g => `<button data-grade="${g}" class="${state.grade===g?'active':''}">${g}</button>`).join("");

  // ì´ë²¤íŠ¸ ì—°ê²°
  genderContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.gender = btn.dataset.gender;
      renderFilters();
      filterAndRender();
    });
  });

  categoryContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.category = btn.dataset.category;
      renderFilters();
      filterAndRender();
    });
  });

  gradeContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.grade = btn.dataset.grade;
      renderFilters();
      filterAndRender();
    });
  });
}

// í•„í„° ì ìš© í›„ ë Œë”ë§
function filterAndRender() {
  let result = ITEMS.slice();

  if(state.gender !== "ì „ì²´") result = result.filter(i => i.gender===state.gender);
  if(state.category !== "ì „ì²´") result = result.filter(i => i.category===state.category);
  if(state.grade !== "ì „ì²´") result = result.filter(i => i.grade===state.grade);

  if(state.searchQuery){
    const q = removeSpaces(state.searchQuery.toLowerCase());
    result = result.filter(i=>removeSpaces(i.name.toLowerCase()).includes(q));
  }

  renderList(result);
}

// ê²€ìƒ‰ ì´ë²¤íŠ¸
document.getElementById("searchInput").addEventListener("input", e=>{
  state.searchQuery = e.target.value;
  filterAndRender();
});

// ì•„ì´í…œ ë Œë”ë§
function renderList(items){
  const listEl = document.getElementById("itemList");
  const noResultsEl = document.getElementById("noResults");

  if(items.length===0){ listEl.innerHTML=""; noResultsEl.style.display="block"; return; }
  noResultsEl.style.display="none";

  listEl.innerHTML = items.map(item=>`
    <li>
      <div class="item-row">
        <div class="item-name">${item.name}</div>
        <div class="item-info">
          <span class="badge gender">${item.gender}</span>
          <span class="badge grade-${item.grade}">${item.grade}</span>
          <span class="badge price">${item.price.toLocaleString()}ì›</span>
          <span class="badge qty">ì¬ê³  ${item.quantity}ê°œ</span>
        </div>
      </div>
    </li>
  `).join("");
}

loadItems();
</script>

</body>
</html>
