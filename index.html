<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>김고난 아이템 목록</title>

<style>
* { box-sizing: border-box; }

body {
  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem;
  background: #f8fafc;
  color: #1e293b;
}

h1 { font-size: 1.8rem; margin-bottom: 1rem; display: flex; align-items: center; justify-content: space-between; }

.header-link {
  font-size: 0.9rem;
  font-weight: 500;
  color: #3b82f6;
  text-decoration: none;
  background: #e0f2fe;
  padding: 0.3rem 0.6rem;
  border-radius: 6px;
  white-space: nowrap;
}

.header-link:hover {
  text-decoration: underline;
  background: #bae6fd;
}

.search-box {
  width: 100%;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  margin-bottom: 1rem;
}

.filter-group {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
  align-items: center;
}

.filter-group .label {
  font-weight: 600;
  margin-right: 0.5rem;
  white-space: nowrap;
}

.filter-group button {
  padding: 0.4rem 0.8rem;
  border: 1px solid #e2e8f0;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
}

.filter-group button.active {
  background: #3b82f6;
  color: white;
  border-color: #3b82f6;
}

.item-list { list-style: none; padding: 0; margin: 0; }

.item-list li {
  padding: 1rem 1.25rem;
  background: white;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  transition: 0.2s;
}

.item-list li:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

.item-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }

.item-name { font-weight: 600; }

.item-info { display: flex; gap: 0.5rem; flex-wrap: wrap; }

.badge {
  padding: 0.3rem 0.7rem;
  font-size: 0.75rem;
  border-radius: 999px;
  font-weight: 600;
}

/* 등급 색상 */
.grade-골드 { background: #facc15; color: #78350f; }
.grade-퍼플 { background: #a855f7; color: white; }
.grade-블루 { background: #3b82f6; color: white; }
.grade-레드 { background: #ef4444; color: white; }
.grade-그린 { background: #22c55e; color: white; }

/* 가격, 수량, 성별 */
.price { background: #dcfce7; color: #166534; }
.qty { background: #e2e8f0; color: #334155; }
.gender { background: #f0fdfa; color: #0f766e; }

.no-results { text-align: center; padding: 3rem; color: #64748b; background: white; border-radius: 8px; }

</style>
</head>

<body>

<!-- 헤더 + 문의 링크 -->
<h1>
  김고난 아이템 목록
  <a href="https://open.kakao.com/o/szMFlV7g" target="_blank" rel="noopener" class="header-link">김고난에게 문의하기!</a>
</h1>

<input type="text" class="search-box" id="searchInput" placeholder="검색어를 입력하세요 (띄어쓰기 무시)">

<!-- 필터 버튼 그룹 순서: 카테고리 → 성별 → 등급 -->
<div class="filter-group" id="categoryFilters">
  <span class="label">[카테고리]</span>
</div>
<div class="filter-group" id="genderFilters">
  <span class="label">[성별]</span>
</div>
<div class="filter-group" id="gradeFilters">
  <span class="label">[등급]</span>
</div>

<ul class="item-list" id="itemList"></ul>
<div class="no-results" id="noResults" style="display:none;">
검색 결과가 없습니다.
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbytKwgl8ya7_Vg6-vObEJUjeFii4yuvsqNn0BBWNBt7YORXEN7mv2FSc4KAoGscL-RVwA/exec";

let ITEMS = [];

const state = {
  category: "전체",
  grade: "전체",
  gender: "전체",
  searchQuery: ""
};

const GENDERS = ["전체","남성","여성","공용"];

function removeSpaces(str) { return str.replace(/\s/g,""); }

async function loadItems() {
  try {
    const response = await fetch(WEB_APP_URL + "?t=" + Date.now());
    const data = await response.json();

    ITEMS = data.map(item => ({
      name: item.name,
      category: item.category,
      grade: item.grade,
      price: Number(item.price),
      quantity: Number(item.quantity),
      gender: item.gender && item.gender.trim()!=="" ? item.gender : "공용"
    })).filter(i=>i.quantity>0);

    renderFilters();
    filterAndRender();

  } catch(e) {
    console.error(e);
    alert("데이터를 불러오지 못했습니다.");
  }
}

// 필터 버튼 렌더링
function renderFilters() {
  // 카테고리
  const categories = ["전체", ...new Set(ITEMS.map(i=>i.category))];
  const categoryContainer = document.getElementById("categoryFilters");
  categoryContainer.innerHTML = `<span class="label">[카테고리]</span>` + categories.map(c => 
    `<button data-category="${c}" class="${state.category===c?'active':''}">${c}</button>`).join("");

  // 성별
  const genderContainer = document.getElementById("genderFilters");
  genderContainer.innerHTML = `<span class="label">[성별]</span>` + GENDERS.map(g => 
    `<button data-gender="${g}" class="${state.gender===g?'active':''}">${g}</button>`).join("");

  // 등급
  const grades = ["전체", ...new Set(ITEMS.map(i=>i.grade))];
  const gradeContainer = document.getElementById("gradeFilters");
  gradeContainer.innerHTML = `<span class="label">[등급]</span>` + grades.map(g => 
    `<button data-grade="${g}" class="${state.grade===g?'active':''}">${g}</button>`).join("");

  // 이벤트 연결
  categoryContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.category = btn.dataset.category;
      renderFilters();
      filterAndRender();
    });
  });

  genderContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.gender = btn.dataset.gender;
      renderFilters();
      filterAndRender();
    });
  });

  gradeContainer.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", ()=>{
      state.grade = btn.dataset.grade;
      renderFilters();
      filterAndRender();
    });
  });
}

// 필터 적용 후 렌더링
function filterAndRender() {
  let result = ITEMS.slice();

  if(state.gender !== "전체") result = result.filter(i => i.gender===state.gender);
  if(state.category !== "전체") result = result.filter(i => i.category===state.category);
  if(state.grade !== "전체") result = result.filter(i => i.grade===state.grade);

  if(state.searchQuery){
    const q = removeSpaces(state.searchQuery.toLowerCase());
    result = result.filter(i=>removeSpaces(i.name.toLowerCase()).includes(q));
  }

  renderList(result);
}

// 검색 이벤트
document.getElementById("searchInput").addEventListener("input", e=>{
  state.searchQuery = e.target.value;
  filterAndRender();
});

// 아이템 렌더링
function renderList(items){
  const listEl = document.getElementById("itemList");
  const noResultsEl = document.getElementById("noResults");

  if(items.length===0){ listEl.innerHTML=""; noResultsEl.style.display="block"; return; }
  noResultsEl.style.display="none";

  listEl.innerHTML = items.map(item=>`
    <li>
      <div class="item-row">
        <div class="item-name">${item.name}</div>
        <div class="item-info">
          <span class="badge gender">${item.gender}</span>
          <span class="badge grade-${item.grade}">${item.grade}</span>
          <span class="badge price">${item.price.toLocaleString()}원</span>
          <span class="badge qty">재고 ${item.quantity}개</span>
        </div>
      </div>
    </li>
  `).join("");
}

loadItems();
</script>

</body>
</html>
